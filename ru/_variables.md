
# Переменные

Переменные являются сутью любого языка программирования. Они позволяют нам использовать значения без необходимости копировать их снова и снова. Самое главное, что они позволяют обновлять это значение очень просто. Никакого больше поиска с заменой или ручной рутины.

Однако, CSS – не что иное, как огромная корзина, содержащая все наши яйца. В отличие от многих языков, нет никаких реальных областей видимости в CSS. Из-за этого мы должны уделять много внимания при добавлении переменных из-за риска споров между ними.

Я советую создавать переменные только когда это имеет смысл. Не создавайте новые переменные чёрт знает зачем, это не поможет. Новая переменная должна быть создана только тогда, когда выполняются следующие условия:

* это значение повторяется хотя бы дважды;
* это значение скорее всего будет обновлено хотя бы один раз;
* все вхождения значения привязаны к переменной (т.е не по стечению обстоятельств).

В принципе, нет никакого смысла объявлять переменную, которая никогда не будет обновлена или которая используется только в одном месте.

## Области видимости

Области видимости переменных в Sass с годами менялись. До недавнего времени, объявленые переменных в пределах наборов правил и других областей видимости были локальными по умолчанию. Однако, если уже была глобальная переменная с тем же именем, изменение значения локальной переменной изменило бы глобальную. Начиная с версии 3.4, Sass правильно исполняет задумку областей видимости и создаёт новую локальную переменную вместо перезаписи глобальной.

Документация говорит о *затенении глобальной переменной*. При объявлении переменной, которая уже существует в глобальной области видимости, во внутренней области видимости (селектор, функция, примесь…), локальная переменная называется *затенённой* глобальной. В общем, она перезаписывается только для локальной области видимости.

Следующий фрагмент кода объясняет задумку *затенения переменных*.

<div class="code-block">
  <div class="code-block__wrapper" data-syntax="scss">
{% highlight scss %}
// Объявить глобальную переменную на корневом уровне.
$variable: 'initial value';

// Создать примесь, которая перезаписывает глобальные переменные.
@mixin global-variable-overriding {
  $variable: 'mixin value' !global;
}

.local-scope::before {
  // Создать локальную переменную, которая затеняет глобальную.
  $variable: 'local value';

  // Применить примесь: она перезапишет глобальную переменную.
  @include global-variable-overriding;

  // Вывести значение переменной.
  // Здесь значение из **локальной** переменной, так как она затеняет
  // глобальную.
  content: $variable;
}

// Вывести эту переменную в другом селекторе, который не делает затенения.
// Здесь значение **глобальное**, как и ожидалось.
.other-local-scope::before {
  content: $variable;
}
{% endhighlight %}
  </div>
  <div class="code-block__wrapper" data-syntax="sass">
{% highlight sass %}
// Объявить глобальную переменную на корневом уровне.
$variable: 'initial value'

// Создать примесь, которая перезаписывает глобальные переменные.
@mixin global-variable-overriding
  $variable: 'mixin value' !global

.local-scope::before
  // Создать локальную переменную, которая затеняет глобальную.
  $variable: 'local value'

  // Применить примесь: она перезапишет глобальную переменную.
  +global-variable-overriding

  // Вывести значение переменной.
  // Здесь значение из **локальной** переменной, так как она затеняет
  // глобальную.

// Вывести эту переменную в другом селекторе, который не делает затенения.
// Здесь значение **глобальное**, как и ожидалось.
.other-local-scope::before
  content: $variable
{% endhighlight %}
  </div>
</div>

## Флаг `!default`

При построении библиотеки, фреймворка, сетки или любого кода Sass, который предназначен для использования другими разработчиками, все переменные должны быть определены с флагом `!default`, чтобы они могли быть перезаписаны.

<div class="code-block">
  <div class="code-block__wrapper" data-syntax="scss">
{% highlight scss %}
$baseline: 1em !default;
{% endhighlight %}
  </div>
  <div class="code-block__wrapper" data-syntax="sass">
{% highlight sass %}
$baseline: 1em !default
{% endhighlight %}
  </div>
</div>

Благодаря этому, разработчик может определить свою собственную переменную `$baseline` *перед* импортом вашей библиотеки, при этом она не будет переопределена.

<div class="code-block">
  <div class="code-block__wrapper" data-syntax="scss">
{% highlight scss %}
// Переменная разработчика
$baseline: 2em;

// Ваша библиотека определяет `$baseline`
@import 'your-library';

// $baseline == 2em;
{% endhighlight %}
  </div>
  <div class="code-block__wrapper" data-syntax="sass">
{% highlight sass %}
// Переменная разработчика
$baseline: 2em

// Ваша библиотека определяет `$baseline`
@import your-library

// $baseline == 2em
{% endhighlight %}
  </div>
</div>

## Флаг `!global`

Флаг `!global` следует использовать только тогда, когда вы переопределяете глобальную переменную из локальной области видимости. При определении переменной на корневом уровне, флаг `global` должен быть опущен.

<div class="code-block">
  <div class="code-block__wrapper" data-syntax="scss">
{% highlight scss %}
// Yep
$baseline: 2em;

// Nope
$baseline: 2em !global;
{% endhighlight %}
  </div>
  <div class="code-block__wrapper" data-syntax="sass">
{% highlight sass %}
// Yep
$baseline: 2em

// Nope
$baseline: 2em !global
{% endhighlight %}
  </div>
</div>

## Много переменных или карты

Существуют преимущества использования карт перед несколькими отдельными переменными. Главным преимуществом является возможность использовать карты в циклах, чего нельзя сделать с отдельными переменными.

Другое преимущество использования карт в способности создать небольшую функцию для получения значений, чтобы обеспечить удобный API. Например, рассмотрим следующий код Sass:

<div class="code-block">
  <div class="code-block__wrapper" data-syntax="scss">
{% highlight scss %}
/// Карта Z-index’ов, собирает все Z-слои приложения
/// @access private
/// @type Map
/// @prop {String} key - Имя слоя
/// @prop {Number} value - значение Z, соответствущее ключу
$z-indexes: (
  'modal': 5000,
  'dropdown': 4000,
  'default': 1,
  'below': -1,
);

/// Получение значения z-index из имени слоя
/// @access public
/// @param {String} $layer - Имя слоя
/// @return {Number}
/// @require $z-indexes
@function z($layer) {
  @return map-get($z-indexes, $layer);
}
{% endhighlight %}
  </div>
  <div class="code-block__wrapper" data-syntax="sass">
{% highlight sass %}
/// Карта Z-index’ов, собирает все Z-слои приложения
/// @access private
/// @type Map
/// @prop {String} key - Имя слоя
/// @prop {Number} value - значение Z, соответствущее ключу
$z-indexes: ('modal': 5000, 'dropdown': 4000, 'default': 1, 'below': -1,)

/// Получение значения z-index из имени слоя
/// @access public
/// @param {String} $layer - Имя слоя
/// @return {Number}
/// @require $z-indexes
@function z($layer)
  @return map-get($z-indexes, $layer)
{% endhighlight %}
  </div>
</div>
